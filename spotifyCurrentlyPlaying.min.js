/**
 *
 *  ----------------------------------
 *  Spotify Currently Playing - v1.0.0
 *  ----------------------------------
 *
 *  Display your most recently played Spotify song using Last.fm scrobbling.
 *
 *  https://github.com/kjbrum/spotify-currently-playing
 *  @license Copyright (c) Kyle Brumm <http://kylebrumm.com>
 *
 */
!function(t){var e=function(t,r,o,s,i){return new e.init(t,r,o,s,i)};e.prototype={displayPlayer:function(){if(!this.selector)throw"Missing selector";var t=this;this.queryLastfm(function(){t.searchSpotify(function(){if(""!=t.spotifyURI){"string"==typeof t.selector&&(container=document.querySelector(t.selector));var e=document.createElement("iframe");e.width=t.width,e.height=t.height,e.src="https://embed.spotify.com/?uri="+encodeURIComponent(t.spotifyURI),e.frameBorder=0,e.setAttribute("allowtransparency","true"),container.appendChild(e)}else console.log("No track found")})})},validateLastFM:function(){if(!this.username)throw"missing username";if(!this.api_key)throw"missing api_key";console.log("Validating Last.FM..."),console.log("Username: "+this.username),console.log("API Key: "+this.api_key)},queryLastfm:function(t){var e=this,r="http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user="+this.username+"&api_key="+this.api_key+"&limit=1&format=json",o=new XMLHttpRequest;o.open("GET",r,!0),o.onload=function(){if(!(o.status>=200&&o.status<400))throw"error from the server";var r,s=JSON.parse(o.responseText);r=s.recenttracks.track[0]?s.recenttracks.track[0]:s.recenttracks.track,e.lastfmTrack={title:r.name,artist:r.artist["#text"],album:r.album["#text"]},t()},o.onerror=function(){throw"connection error"},o.send()},searchSpotify:function(t){var e=this,r="",o=e.lastfmTrack;for(var s in o)o.hasOwnProperty(s)&&o[s]&&(r+=s+":"+o[s]+" ");var i="https://api.spotify.com/v1/search?query="+encodeURIComponent(r)+"&offset=0&limit=1&type=track",n=new XMLHttpRequest;n.open("GET",i,!0),n.onload=function(){if(!(n.status>=200&&n.status<400))throw"error from the server";var r=JSON.parse(n.responseText);r.tracks.items[0]&&(e.spotifyURI=r.tracks.items[0].uri),t()},n.onerror=function(){throw"connection error"},n.send()}},e.init=function(t,e,r,o,s){var i=this;i.selector=t||"",i.username=e||"",i.api_key=r||"",i.width=o||"300",i.height=s||"400",i.lastfmTrack={title:"",artist:"",album:""},i.spotifyURI="",i.validateLastFM(),i.displayPlayer()},e.init.prototype=e.prototype,t.Spotify=e}(window);