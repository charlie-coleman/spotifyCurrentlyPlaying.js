/**
 *
 *  -----------------------------------
 *  spotifyCurrentlyPlaying.js - v0.2.0
 *  -----------------------------------
 *
 *  Display your currently playing Spotify song using Last.fm scrobbling.
 *
 *  https://github.com/kjbrum/spotifyCurrentlyPlaying.js
 *  @license Copyright (c) Kyle Brumm <http://kylebrumm.com>
 *
 */
!function(t){var e=function(t,r,i,o,s,a,n,c){return new e.init(t,r,i,o,s,a,n,c)};e.prototype={displayPlayer:function(){if(!this.selector)throw"Missing selector";var t=this;this.queryLastfm(function(){t.searchSpotify(function(){var e=t.selector;if("string"==typeof t.selector&&(e=document.querySelector(t.selector)),""!=t.spotifyURI||""!=t.backup_id){var r=document.createElement("iframe");r.width=t.width,r.height=t.height,r.frameBorder=0,r.setAttribute("allowtransparency","true");var i;i=""!=t.spotifyURI?t.spotifyURI:"spotify:track:"+t.backup_id,r.src="https://embed.spotify.com/?uri="+i+"&theme="+t.theme+"&view="+t.view,e.appendChild(r)}else{var o=document.createElement("p"),s=document.createTextNode("No track found.");o.appendChild(s),e.appendChild(o)}})})},queryLastfm:function(t){var e=this,r="http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user="+this.username+"&api_key="+this.api_key+"&limit=1&format=json",i=new XMLHttpRequest;i.open("GET",r,!0),i.onload=function(){var r=JSON.parse(i.responseText);if(!(i.status>=200&&i.status<400))throw r.message;var o;o=r.recenttracks.track[0]?r.recenttracks.track[0]:r.recenttracks.track,e.lastfmTrack={title:o.name,artist:o.artist["#text"],album:o.album["#text"]},t()},i.onerror=function(){throw"connection error"},i.send()},searchSpotify:function(t){var e=this,r="",i=e.lastfmTrack;for(var o in i)i.hasOwnProperty(o)&&i[o]&&(r+=o+":"+i[o]+" ");var s="https://api.spotify.com/v1/search?query="+encodeURIComponent(r)+"&offset=0&limit=1&type=track",a=new XMLHttpRequest;a.open("GET",s,!0),a.onload=function(){var r=JSON.parse(a.responseText);if(!(a.status>=200&&a.status<400))throw r.message;r.tracks.items[0]&&(e.spotifyURI=r.tracks.items[0].uri),t()},a.onerror=function(){throw"connection error"},a.send()}},e.init=function(t,e,r,i,o,s,a,n){var c=this;c.selector=t||"",c.username=e||"",c.api_key=r||"",c.width=i||"300",c.height=o||"400",c.theme=s||"black",c.view=a||"list",c.backup_id=n||"",c.lastfmTrack={title:"",artist:"",album:""},c.spotifyURI="",c.displayPlayer()},e.init.prototype=e.prototype,t.SpotifyCurrentlyPlaying=t.SCP=e}(window);